<template>
  <section class="min-h-screen">
    <div class="container">
      <PostList :posts="indexPosts" :pagination="indexPagination" />
    </div>
  </section>
</template>

<script>
import PostList from "@/components/PostList.vue";
export default {
  name: "PostIndex",
  components: {
    PostList
  },
  async fetch({ params, store, error, payload }) {
    if (payload) {
      store.commit("setIndexPosts", payload);
    } else {
      let pageNumber = 1;
      if (params.pageNumber) {
        pageNumber = params.pageNumber;
      }
      try {
        await store.dispatch("getIndexPosts", {
          filter: "",
          pageNumber
        });
      } catch (e) {
        // as far as user is concerned this isn't an API failure
        error({ statusCode: 404, message: e.message });
      }
      // remember to use await here so data will be available
    }
  },
  computed: {
    indexPosts() {
      return this.$store.state.indexPosts;
    },
    indexPagination() {
      return this.$store.state.indexPagination;
    },
    siteSettings() {
      return this.$store.state.siteSettings;
    }
  }
};
</script>
